
/*****************************************/
/*           {{name|replace('_', '-')}}                */
/*****************************************/
//sequence normal
// Các nội dung cần thiết cho template seq_normal.c.j2
{% for primitive in primitive_files_data %}
    // Nội dung của file .c cho primitive {{ primitive.name }}
    {{ primitive.c_file_content }}
{% endfor %}

// Các phần còn lại của template seq_normal.c.j2
//contain extensition bit -> theo mau cua GlobalgNB-ID
int asn1PE_e2ap_{{name}} (OSCTXT* pctxt, e2ap_{{name}}* pvalue)
{
   int stat = 0;
   OSBOOL extbit = FALSE;
   RTXCTXTPUSHTYPENAME(pctxt, "{{name|replace('_', '-')}}");

   /*extension bit*/
   extbit = (OSBOOL)(pvalue->extElem1.count > 0);
   stat = rtxEncBit (pctxt, extbit);
   if (stat != 0) return LOG_RTERR(pctxt, stat);

{% for f in fields %}
{% if f.presence == "optional" %}
   /*optional bit for field {{f.field}}*/
   stat = rtxEncBit (pctxt, pvalue->m_{{f.field}}Present);
   if (stat != 0) return LOG_RTERR(pctxt, stat);
{% endif %}
{% endfor %}

   /*encode root elements*/   
{% for f in fields %}
   /* encode field {{f.field}} - id = {{f.primitive_meta.primitive_id }}*/  
{% if f.presence == "optional" %}
   if (pvalue->m_{{f.field}}Present) {//OPTIONAL FIELD
{% endif %}
   RTXCTXTPUSHELEMNAME(pctxt, "{{f.field |replace('_', '-')}}");
   {%if f.field == "protocolIEs"%}
   stat = asn1PE_e2ap_{{name|replace('-', '_')}}_protocolIEs (pctxt, &pvalue->protocolIEs);
   {% elif f.primitive_meta.is == True %}{#    //primitive field in scope#}
      {% if f.primitive_meta.primitive_id == 2%}
   stat = asn1PE_e2ap_{{name}}_{{f.field}}(pctxt, pvalue->{{f.field|replace("-","_")}}); //primitive
      {% endif %}
      {% if f.primitive_meta.primitive_id == 3 or f.primitive_meta.primitive_id == 4 %}
   stat = asn1PE_e2ap_{{name}}_{{f.field}}(pctxt, &pvalue->{{f.field|replace("-","_")}}); //primitive
      {% endif %}
      {% if f.primitive_meta.primitive_id == 13 %}
   stat = asn1PE_e2ap_{{name}}_{{f.field}}(pctxt, &pvalue->{{f.field|replace("-","_")}}); //enum inter prim
      {% endif %}
      {% if f.primitive_meta.primitive_id ==6 %}
   stat = asn1PE_e2ap_{{name}}_{{f.field}}(pctxt, pvalue->{{f.field|replace("-","_")}}); //intger mau 6 (a..b)
      {% endif %}  
      {% if f.primitive_meta.primitive_id ==9 %}
   stat = asn1PE_e2ap_{{name}}_{{f.field}}(pctxt, pvalue->{{f.field|replace("-","_")}}); //octet string no size - mau 9
      {% endif %}  
   {% else %}{#   // not primitive field or alias #}
      {% if f.alias == 5 or f.alias == 6  or f.alias == 13 or f.alias == 2 or f.alias == 9 %}
   stat = asn1PE_e2ap_{{f.ie_type|replace('-', '_')}} (pctxt, pvalue->{{f.field|replace('_', '_')}});
      {% else %}
   stat = asn1PE_e2ap_{{f.ie_type|replace('-', '_')}} (pctxt, &pvalue->{{f.field|replace('_', '_')}});
      {% endif %}
   {% endif %}
   if (stat != 0) return LOG_RTERR(pctxt, stat);
   RTXCTXTPOPELEMNAME(pctxt);

{% if f.presence == "optional" %}
   }
{% endif %}

{% endfor %}

   {% if extensible %}
   /*
   if (pvalue->extElem1Present) {
      stat = pe_OpenType (pctxt, pvalue->extElem1.numocts, pvalue->extElem1.data);
      if (stat != 0) return LOG_RTERR(pctxt, stat);
   }
   */
   {% endif %}

   if(extbit) {
      /*encode extension optional bits length */
      stat = pe_SmallLength(pctxt, pvalue->extElem1.count);
      if (stat != 0) return LOG_RTERR(pctxt, stat);

      /*encode optional bit*/
      stat = pe_OpenTypeExtBits(pctxt, &pvalue->extElem1);
      if (stat != 0) return LOG_RTERR(pctxt, stat);

      /*encode extension elements*/
      if (pvalue->extElem1.count > 0) {
         //stat = pe_OpenType (pctxt, pvalue->extElem1.numocts, pvalue->extElem1.data);
         stat = pe_OpenTypeExt(pctxt, &pvalue->extElem1);
         if (stat != 0) return LOG_RTERR(pctxt, stat);
      }
   }

   RTXCTXTPOPTYPENAME(pctxt);
   return (stat);
}

int asn1PD_e2ap_{{name}} (OSCTXT* pctxt, e2ap_{{name}}* pvalue)
{
   int stat =0;
   ASN1OpenType openType;
   ASN1OpenType* pOpenType;
   OSUINT32 bitcnt;
   OSUINT32 i_;
   OSBOOL extbit = FALSE;
   OSBOOL optbits[{{fields|length}}];

   RTXCTXTPUSHTYPENAME(pctxt, "{{name|replace('_', '-')}}");

   /*extension bit*/
   stat = DEC_BIT(pctxt, &extbit);
   if (stat != 0) return LOG_RTERR(pctxt, stat);
   rtxDListInit(&pvalue->extElem1); 

   /*optional bits*/
   for(i_ = 0; i_ < {{fields|length}}; i_++) {
      stat = DEC_BIT(pctxt, &optbits[i_]);
      if (stat != 0) return LOG_RTERR(pctxt, stat);
   }

   /*decode root elements*/
{% for f in fields %}
   /* decode field {{f.field}} */
   RTXCTXTPUSHELEMNAME(pctxt, "{{f.field |replace('_', '-')}}");
{% if f.presence == "optional" %}
   if (optbits[0]) {
      pvalue->m_{{f.field}}Present = TRUE;
{% endif %}
      {%if f.field == "protocolIEs"%}
      stat = asn1PD_e2ap_{{name|replace('-', '_')}}_protocolIEs (pctxt, &pvalue->protocolIEs);
      {% elif f.primitive_meta.is == True %}
      stat = asn1PD_e2ap_{{name}}_{{f.field}} (pctxt, &pvalue->{{f.field|replace('-','_')}}); //primitive
      {% else %}
      stat = asn1PD_e2ap_{{f.ie_type|replace('-', '_')}} (pctxt, &pvalue->{{f.field|replace('-', '_')}});
      {% endif %}
      if (stat != 0) return LOG_RTERR(pctxt, stat);
{% if f.presence == "optional" %}
   } else {
      pvalue->m_{{f.field}}Present = FALSE;
   }
{% endif %}
   RTXCTXTPOPELEMNAME(pctxt);

{% endfor %}

   /*decode extension elements*/
   if(extbit) {
      OSOCTET *poptbits;
      /*decode optional bits length */
      stat = pd_SmallLength(pctxt, &bitcnt);
      if (stat != 0) return LOG_RTERR(pctxt, stat);

      /*decode optional bits*/
      poptbits = (OSOCTET*)rtxMemAlloc(pctxt, bitcnt);
      if(0==poptbits) return LOG_RTERR(pctxt, RTERR_NOMEM);

      for(i_ = 0; i_ < bitcnt; i_++) {
         stat = DEC_BIT(pctxt, &poptbits[i_]);
         if (stat != 0) {
            rtxMemFreePtr(pctxt, poptbits);
            return LOG_RTERR(pctxt, stat);
         }
      }

      for(i_ = 0; i_ < bitcnt; i_++) {
         if(stat != 0) break;
         if(poptbits[i_]) {
            /*decode extension element*/
            stat = pd_OpenType (pctxt, &openType, &openType.numocts);

            if(0==stat){
               pOpenType = rtxMemAllocType(pctxt, ASN1OpenType);
               if(0!=pOpenType){
                  pOpenType->numocts = openType.numocts;
                  pOpenType->data = openType.data;
                  rtxDListAppend(pctxt, &pvalue->extElem1, pOpenType);
               }
               else stat = RTERR_NOMEM;
            }
            else{
               LOG_RTERR(pctxt, stat);
               break;
            }
         }
         else{//unknown element
            rtxDListAppend(pctxt, &pvalue->extElem1, 0);
         }
      }
      rtxMemFreePtr(pctxt, poptbits);
   }

   RTXCTXTPOPTYPENAME(pctxt);

   return (stat);

}

int asn1Init_e2ap_{{name}} (e2ap_{{name}}* pvalue)
{
   if(0==pvalue) return RTERR_NULLPTR;
   {% for f in fields %}
   {% if not f.primitive_meta.is %}
       {%if f.field == "protocolIEs"%}
   asn1Init_e2ap_{{name|replace('-', '_')}}_protocolIEs (&pvalue->protocolIEs);
      {% else %}
   asn1Init_e2ap_{{f.ie_type|replace('-', '_')}} (&pvalue->{{f.field|replace('-', '_')}});
       {% endif %}
   {% else %}
   asn1Init_e2ap_{{name}}_{{f.field}} (&pvalue->{{f.field|replace('-','_')}}); //primitive delete &
   {% endif %}
   {% endfor %}
   rtxDListFastInit(&pvalue->extElem1);
   return 0;
}

void asn1Free_e2ap_{{name}} (OSCTXT* pctxt, e2ap_{{name}}* pvalue)
{
   if(0==pvalue) return;
{% for f in fields %}
   {% if not f.primitive_meta.is %}
      {%if f.field == "protocolIEs"%}
   asn1Free_e2ap_{{name|replace('-', '_')}}_protocolIEs (pctxt, &pvalue->protocolIEs);
      {% else %}
   asn1Free_e2ap_{{f.ie_type|replace("-","_")}} (pctxt, &pvalue->{{f.field|replace("-","_")}});
      {% endif %}
   {% elif f.primitive_meta.primitive_id ==2 %}
   asn1Free_e2ap_{{name}}_{{f.field}} (pctxt, &pvalue->{{f.field|replace('-','_')}}); //primitive delete &
   {% endif %}
{% endfor %}
   rtxMemFreeOpenSeqExt(pctxt, &pvalue->extElem1);
}

int asn1PrtToStr_e2ap_{{name}} (const char* name, e2ap_{{name}}* pvalue, char* buffer, OSSIZE bufSize)
{
   if(rtPrintToStringOpenBrace(name, buffer, bufSize) < 0) 
   {
      return -1;
   }
{% for f in fields%}
   {% if not (f.primitive.isprimitive and f.ie_type !="BIT STRING") %}
      {%if f.field == "protocolIEs"%}
   if(asn1PrtToStr_e2ap_{{name|replace('-', '_')}}_protocolIEs ("protocolIEs", &pvalue->protocolIEs, buffer, bufSize) < 0)
   {
      return -1;
   }
      {% else %}
   if(asn1PrtToStr_e2ap_{{f.ie_type|replace('-', '_')}} ("{{f.field |replace('-', '_')}}", &pvalue->{{f.field|replace("-","_")}}, buffer, bufSize) < 0)
   {
      return -1;
   }
     {% endif %}
   {% endif %}

   {% if f.primitive.isprimitive == True %}
   if(asn1PrtToStr_e2ap_{{name}}_{{f.field}} ("{{f.field |replace('-', '_')}}", &pvalue->{{f.field|replace("-","_")}}, buffer, bufSize) < 0)
   {
      return -1;
   }
   {% endif %}

{% endfor %}

   /*assum there is an extension*/
   if(rtPrintToStringOpenTypeExtBraceText("extElem1", &pvalue->extElem1, buffer, bufSize) < 0)
   {
      return -1;
   }
   if(rtPrintToStringCloseBrace(buffer, bufSize) < 0) return -1;
   return 0;
}